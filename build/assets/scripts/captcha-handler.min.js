!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("CaptchaHandler",[],e):"object"==typeof exports?exports.CaptchaHandler=e():t.CaptchaHandler=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=n(11);e.GeeTestRejectError=o["default"];var i=n(2);e.VerifyRejectState=i.VerifyRejectState,e["default"]=r["default"]},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),i=n(5),c=n(7),a=n(6),s=n(11),u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.geeTestSettings,o=void 0===n?{}:n,i=e.pictureSettings,c=void 0===i?{}:i;r(this,t),this.geeTestSettings=o,this.pictureSettings=c}return t.decorate=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(t){return t};"function"==typeof e&&(n=e,e=void 0);var r=new t(e),i=void 0;return function(t){t[t.MethodDecorate=1]="MethodDecorate",t[t.ES5Function=2]="ES5Function"}(i||(i={})),function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=void 0;t&&e&&i?c=1:"function"==typeof t&&(c=2,i.value=t);var a=i.value;if(i.value=function(){var t=arguments;return new Promise(function(e,i){var c,u,f,p,l,d,h;return Promise.resolve(r.verify()).then(function(v){try{if(c=v,u=c.state,f=c.data,u===o.VerifyRejectState.Success){for(r.reset(),p=t.length,l=Array(p),d=0;d<p;d++)l[d]=t[d];return h=n(l,f),"[object Array]"===Object.prototype.toString.call(h)?e(a.apply(this,n(h))):i(new Error("<intercept> 函数必须返回数组类型"))}return e(Promise.reject(new s["default"](u,f)))}catch(y){return i(y)}}.bind(this),i)}.bind(this))},1===c)return i;if(2===c)return i.value;throw new Error("unexpected condition. please contact the author")}},t.prototype.init=function(){return new Promise(function(e,n){var r,s,u;if(this.captchaModel){if(this.captchaModel instanceof c["default"]&&this.captchaModel.getState()!==a.CaptchaModelStateEnum.Reset)return e();if(this.captchaModel instanceof i["default"])return e()}r=this.pictureSettings,s=this.geeTestSettings,t.preProcessGeetestSettings(s);var f=function(){try{return e()}catch(t){return n(t)}}.bind(this),p=function(t){try{if(t instanceof Error)throw t;return this.captchaModel=new c["default"](r),f()}catch(e){return n(e)}}.bind(this);try{return Promise.resolve(o["default"].authAndInit(s)).then(function(t){try{return u=t,this.captchaModel=new i["default"](u),f()}catch(e){return p(e)}}.bind(this),p)}catch(l){p(l)}}.bind(this))},t.preProcessGeetestSettings=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.options=t.options||{};if(e.product||(e.product="bind"),e.product&&"bind"!==e.product)throw new Error("captcha handler 仅支持极验为 {product: 'bind'} 的模式")},t.prototype.verify=function(){return new Promise(function(t,e){return Promise.resolve(this.init()).then(function(n){try{return t(this.captchaModel.verify())}catch(r){return e(r)}}.bind(this),e)}.bind(this))},t.prototype.reset=function(){this.captchaModel.reset()},t}();e["default"]=u},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o,i=n(3),c=n(4);!function(t){t[t.Cancel=0]="Cancel",t[t.Error=-1]="Error",t[t.Success=1]="Success"}(o=e.VerifyRejectState||(e.VerifyRejectState={}));var a=function(){function t(){r(this,t)}return t.authAndInit=function(t){return c["default"](t)},t.init=function(t){return t.width=t.width||"100%",new Promise(function(e){i(t,function(t){t.onReady(function(){return e(t)})})})},t.verify=function(t){var e=t.getValidate();return e?Promise.resolve({state:o.Success,data:e}):new Promise(function(e,n){t.onSuccess(function(){var n=t.getValidate();e({state:o.Success,data:n})}),t.onClose(function(){e({state:o.Cancel})}),t.onError(function(){n({state:o.Error,message:"出错啦，请稍后重试"})}),t.verify()})},t.reset=function(t){t.reset()},t}();e["default"]=a},function(t,e){!function(e,n){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=e.document?n(e,!0):function(t){if(!t.document)throw new Error("Geetest requires a window with a document");return n(t)}:n(e)}("undefined"!=typeof window?window:this,function(t,e){"use strict";function n(t){this._obj=t}function r(t){var e=this;new n(t)._each(function(t,n){e[t]=n})}if("undefined"==typeof t)throw new Error("Geetest requires browser environment");var o=t.document,i=t.Math,c=o.getElementsByTagName("head")[0];n.prototype={_each:function(t){var e=this._obj;for(var n in e)e.hasOwnProperty(n)&&t(n,e[n]);return this}},r.prototype={api_server:"api.geetest.com",protocol:"http://",type_path:"/gettype.php",fallback_config:{slide:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"slide",slide:"/static/js/geetest.0.0.0.js"},fullpage:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"fullpage",fullpage:"/static/js/fullpage.0.0.0.js"}},_get_fallback_config:function(){var t=this;return s(t.type)?t.fallback_config[t.type]:t.new_captcha?t.fallback_config.fullpage:t.fallback_config.slide},_extend:function(t){var e=this;new n(t)._each(function(t,n){e[t]=n})}};var a=function(t){return"number"==typeof t},s=function(t){return"string"==typeof t},u=function(t){return"boolean"==typeof t},f=function(t){return"object"==typeof t&&null!==t},p=function(t){return"function"==typeof t},l={},d={},h=function(){return parseInt(1e4*i.random())+(new Date).valueOf()},v=function(t,e){var n=o.createElement("script");n.charset="UTF-8",n.async=!0,n.onerror=function(){e(!0)};var r=!1;n.onload=n.onreadystatechange=function(){r||n.readyState&&"loaded"!==n.readyState&&"complete"!==n.readyState||(r=!0,setTimeout(function(){e(!1)},0))},n.src=t,c.appendChild(n)},y=function(t){return t.replace(/^https?:\/\/|\/$/g,"")},b=function(t){return t=t.replace(/\/+/g,"/"),0!==t.indexOf("/")&&(t="/"+t),t},g=function(t){if(!t)return"";var e="?";return new n(t)._each(function(t,n){(s(n)||a(n)||u(n))&&(e=e+encodeURIComponent(t)+"="+encodeURIComponent(n)+"&")}),"?"===e&&(e=""),e.replace(/&$/,"")},m=function(t,e,n,r){e=y(e);var o=b(n)+g(r);return e&&(o=t+e+o),o},w=function(t,e,n,r,o){var i=function(c){var a=m(t,e[c],n,r);v(a,function(t){t?c>=e.length-1?o(!0):i(c+1):o(!1)})};i(0)},x=function(e,n,r,o){if(f(r.getLib))return r._extend(r.getLib),void o(r);if(r.offline)return void o(r._get_fallback_config());var i="geetest_"+h();t[i]=function(e){o("success"===e.status?e.data:e.status?r._get_fallback_config():e),t[i]=void 0;try{delete t[i]}catch(n){}},w(r.protocol,e,n,{gt:r.gt,callback:i},function(t){t&&o(r._get_fallback_config())})},E=function(t,e){var n={networkError:"网络错误"};if("function"!=typeof e.onError)throw new Error(n[t]);e.onError(n[t])},C=function(){return!!t.Geetest};C()&&(d.slide="loaded");var j=function(e,n){var o=new r(e);e.https?o.protocol="https://":e.protocol||(o.protocol=t.location.protocol+"//"),x([o.api_server||o.apiserver],o.type_path,o,function(e){var r=e.type,i=function(){o._extend(e),n(new t.Geetest(o))};l[r]=l[r]||[];var c=d[r]||"init";"init"===c?(d[r]="loading",l[r].push(i),w(o.protocol,e.static_servers||e.domains,e[r]||e.path,null,function(t){if(t)d[r]="fail",E("networkError",o);else{d[r]="loaded";for(var e=l[r],n=0,i=e.length;n<i;n+=1){var c=e[n];p(c)&&c()}l[r]=[]}})):"loaded"===c?i():"fail"===c?E("networkError",o):"loading"===c&&l[r].push(i)})};return t.initGeetest=j,j})},function(t,e,n){function r(){return window.location.protocol.slice(0,-1).toLowerCase()}function o(){var t=f[r()];if(!t)throw new Error("若使用默认url地址时，请确保浏览器 url protocol 为 http 或 https");return t}function i(t){if(!t.jsonp)throw new Error("请使用xfe-request完成以下操作")}function c(t){return new Promise(function(e,n){function c(){return s.call(this)}function s(){return g=b,m=g.data,w=m.mode,x=m.config,E=g.code,C=g.state,C&&(E=C),1===E?2===w?e(u["default"].init(Object.assign({},x,h))):1===w?e(Promise.reject(b)):n(new Error("未知 pre auth mode，mode = "+w)):e(Promise.reject(b))}var f,p,l,d,h,v,y,b,g,m,w,x,E,C;return f=t.params,p=t.request,l=t.url,d=void 0===l?o():l,h=t.options,v=t.requestImpl,y=t.requestPreAuthImpl,p&&i(p),y&&(v=y),"object"===("undefined"==typeof d?"undefined":a(d))&&(d=d[r()]),b=void 0,p?Promise.resolve(p.jsonp(d,f)).then(function(t){try{return b=t,s.call(this)}catch(e){return n(e)}}.bind(this),n):v?Promise.resolve(v(d,f)).then(function(t){try{return b=t,c.call(this)}catch(e){return n(e)}}.bind(this),n):n(new Error("请传入 request 或 requestImpl"))}.bind(this))}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(e,"__esModule",{value:!0});var s,u=n(2);!function(t){t[t.Picture=1]="Picture",t[t.GeeTest=2]="GeeTest"}(s||(s={}));var f={http:"http://apps-ws.xoyo.com/passport/pre_auth",https:"https://apps-ws.xoyo.com/passport/pre_auth"};e["default"]=c},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var c=n(2),a=n(6),s=function(t){function e(n){r(this,e);var i=o(this,t.call(this));return i.captchaObj=n,i}return i(e,t),e.prototype.verifyProcess=function(){return new Promise(function(t,e){return t(c["default"].verify(this.captchaObj))}.bind(this))},e.prototype.resetProcess=function(){this.captchaObj.reset()},e}(a["default"]);e["default"]=s},function(t,e){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r;!function(t){t[t.Initialized=1]="Initialized",t[t.Reset=-1]="Reset",t[t.Verified=2]="Verified"}(r=e.CaptchaModelStateEnum||(e.CaptchaModelStateEnum={}));var o=function(){function t(){n(this,t),this.setState(r.Initialized)}return t.prototype.setState=function(t){this.state=t},t.prototype.getState=function(){return this.state},t.prototype.verify=function(){return new Promise(function(t,e){var n;return Promise.resolve(this.verifyProcess()).then(function(o){try{return n=o,this.setState(r.Verified),t(n)}catch(i){return e(i)}}.bind(this),e)}.bind(this))},t.prototype.reset=function(){this.resetProcess(),this.setState(r.Reset)},t}();e["default"]=o},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var c=n(2),a=n(6),s=n(8),u=n(9),f=n(10),p=function(t){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=n.captchaPicUrl,c=void 0===i?"https://apps-ws.xoyo.com/passport/captcha":i,a=n.elementId,s=void 0===a?e.getRandomElementId():a;r(this,e);var u=o(this,t.call(this));return u.captchaPicUrl=c,u.elementId=s,u.onPicCaptchaClick=u.onPicCaptchaClick.bind(u),u}return i(e,t),e.getRandomElementId=function(){return String(s())},e.prototype.verifyProcess=function(){var t=this;return new Promise(function(e){t.resolve=e,t.open()})},e.prototype.resetProcess=function(){this.$pictureCaptcha&&(this.close(),this.$pictureCaptcha.parentNode.removeChild(this.$pictureCaptcha),this.$pictureCaptcha=null)},e.prototype.onSubmitClick=function(){var t=this.$input.value;t?(this.resolve({state:c.VerifyRejectState.Success,data:{phrase:t,tag:this.elementId}}),this.close()):alert("请填写验证码!")},e.prototype.onPicCaptchaClick=function(t){t.target.src=this.refreshPicCaptchaSrc()},e.prototype.refreshPicCaptchaSrc=function(){return this.captchaPicUrl+"?tag="+this.elementId+"&"+ +new Date},e.prototype.onCloseButtonClick=function(){this.resolve({state:c.VerifyRejectState.Cancel,data:null}),this.close()},e.prototype.open=function(){this.$pictureCaptcha||(this.$pictureCaptcha=this.renderPictureCaptcha()),this.$pictureCaptcha.style.display="block",document.body.appendChild(this.$pictureCaptcha)},e.prototype.close=function(){var t=this.$pictureCaptcha;t&&(t.style.display="none")},e.prototype.renderPictureCaptcha=function(){var t=this,e=document.createElement("div");e.innerHTML=u["default"];var n=e.firstChild,r=f.getElementsByClassName("xsj-pic-captcha-close",n)[0];this.$input=f.getElementsByClassName("xsj-pic-captcha-input",n)[0];var o=f.getElementsByClassName("xsj-pic-captcha-img",n)[0];o.src=this.refreshPicCaptchaSrc(),f.addEventListener(o,"click",this.onPicCaptchaClick);var i=f.getElementsByClassName("xsj-pic-captcha-btn",n)[0];return f.addEventListener(r,"click",function(){return t.onCloseButtonClick()}),f.addEventListener(o,"click",this.onPicCaptchaClick),f.addEventListener(i,"click",function(){return t.onSubmitClick()}),f.addEventListener(this.$input,"keyup",function(t){t.preventDefault(),13===t.keyCode&&i.click()}),n},e}(a["default"]);e["default"]=p},function(t,e){function n(t){return t=t||7,Math.random().toString(35).substr(2,t)}t.exports=n},function(t,e){e.__esModule=!0;var n='<div class="xsj-pic-captcha"><div class="xsj-pic-captcha-sliver" style="background: #808080; background-color: rgba(0, 0, 0, 0.5); bottom: 0; left: 0; position: absolute; right: 0; top: 0; z-index: 9000;"></div><div class="xsj-pic-captcha-box" style="background: #fff; left: 50%; margin-left: -160px; padding: 20px; position: absolute; top: 50%; width: 300px; z-index: 9999;"><img class="xsj-pic-captcha-close" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAe0lEQVQ4T7WT0Q2AMAhE7zZyFEdwNEdwFDfCkFRjEVqaxv60TeABB1BETgAbSb3TR0QWADvL4wCwZiGVj4YcgVhb3jlnIJ7NA+hlEgWoABGkld0HYCGlxFBkF2Ag+g079A/gXfNwCZ5gaRFbht02Tg1Sxjma2Pllml3nC2ohigWIYK4xAAAAAElFTkSuQmCC" style="cursor: pointer; font-size: 12px; position: absolute; right: -20px; top: 0;"><div class="xsj-pic-captcha-wrap" style="overflow: hidden; width: 100%;"><input class="xsj-pic-captcha-input" placeholder="&#x8BF7;&#x8F93;&#x5165;&#x9A8C;&#x8BC1;&#x7801;" style="-moz-border-radius: 4px; -moz-box-sizing: content-box; -ms-border-radius: 4px; -o-border-radius: 4px; -webkit-border-radius: 4px; -webkit-box-sizing: content-box; background-color: #fff; border: 1px solid #e6e6e6; border-radius: 4px; box-sizing: content-box; color: #333; float: left; font-size: 14px; height: 48px; line-height: 48px !important; padding: 0 8px; vertical-align: middle; width: 164px;"> <img class="xsj-pic-captcha-img" style="-moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; cursor: pointer; float: right; height: 48px; vertical-align: middle; width: 104px;"></div><button class="xsj-pic-captcha-btn" style="background: #1890ff; border: 1px #1890ff solid; border-radius: 5px; color: #fff; cursor: pointer; display: block; font-size: 16px; height: 44px; margin-top: 10px; width: 100%;">确认</button></div></div>';e["default"]=n},function(t,e){function n(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n.bind(t))}function r(t,e,n){t.removeEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n.bind(t))}function o(t,e){if(e=e||document,e.getElementsByClassName)return e.getElementsByClassName(t);for(var n=[],r=e.getElementsByTagName("*"),o=new RegExp("\\b"+t+"\\b"),i=0;i<r.length;i++)o.test(r[i].className)&&n.push(r[i]);return n}Object.defineProperty(e,"__esModule",{value:!0}),e.addEventListener=n,e.removeEventListener=r,e.addEventListenerOnce=function(){var t=[];return function(e,n,r){var o=t.filter(function(t){return t===e});return!o.length&&(e.addEventListener?e.addEventListener(n,r,!1):e.attachEvent("on"+n,r.bind(e)),void t.push(e))}}(),e.getElementsByClassName=o},function(t,e){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function o(t,e){n(this,o),this.$state=t,this.$data=e};e["default"]=r}])});